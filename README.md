Игра ЖИЗНЬ
==========


Попробуем запрограммировато известную игру Жизнь (придуманную Джоном Конвеем в 1970 году)

Выполним в 3 шага:

 1. Собственно постановка на игру - разработка ядра игры, 
 с использованием тестирования (TDD) - Ruby, RSpec
 2. Разработка веб приложения для визуализации игры - Sinatra
 3. Разворачивание игры на внешнем хостинге - CloudFondry



Кодирование Игры
================

Правила очень простые, из Википедии:

 * Место действия этой игры — "вселенная" — это размеченная на клетки 
 поверхность или плоскость — безграничная, ограниченная, или замкнутая (в пределе — бесконечная плоскость).
 * Каждая клетка на этой поверхности может находиться в двух состояниях: 
 быть "живой" или быть "мёртвой" (пустой). Клетка имеет восемь соседей 
 (окружающих клеток).
 * Распределение живых клеток в начале игры называется первым поколением. 
 Каждое следующее поколение рассчитывается на основе предыдущего по 
 таким правилам:
   * пустая (мёртвая) клетка, рядом с которой ровно три живые клетки, оживает;
   * если у живой клетки есть две или три живые соседки, то эта клетка 
   продолжает жить; в противном случае (если соседей меньше двух или 
   больше трёх) клетка умирает (от "одиночества" или от "перенаселённости").
 * Игра прекращается, если на поле не останется ни одной "живой" клетки, или если при очередном шаге ни одна из клеток не меняет своего состояния (складывается стабильная конфигурация).

Выбираем основное:

1. Есть матрица ячеек, ROWS и COLS
2. Ячейка может быть заполена либо не заполнена
3. У каждой ячейки есть соседние ячейки (8 шт)
4. Есть начальное заполнение
5. Есть шаг
6. На следующем шаге:
  1. В пустой ячейке появляется жизнь если рядом есть 3 живые ячейки
  2. Живая ячейка продолжает жить, если у неё 2 или 3 соседа
  3. Если соседей меньше 2-х или больше 3-х тогда живая ячейка "погибает".


Создаём папку lib в ней класс game_life.rb

  class GameLife
  end


А сейчас начнём описывать спецификации нашего класса

  rspec --init


Создаём 


    require 'spec_helper'
    require 'game_life'

    describe GameLife do

      it "указывается размер карты - столбцы и ячейки, получаем поле" do
        game = GameLife.new :cols=>3, :rows=>2, :empty_cell=>'.'
        game.screen.should == <<END_MAP
    ...
    ...
    END_MAP
      end

    end


Теперь редактируем наш класс Жизни:

    class GameLife

      NL = "\n"
      
      def initialize(options)
        @rows = options[:rows]
        @cols = options[:cols]
        @empty_cell = options[:empty_cell]
      end

      def screen
        ret = ''
        @rows.times do
          line = ''
          @cols.times do
            line << @empty_cell
          end
          ret << line << NL
        end
        ret
      end

    end


Тесты прошли. Пишем следующую спецификацию





Разработка веб приложения
=========================

Что должно выполнять наше веб приложение?

При заходе - мы должны увидеть некое начальное состояние игры Жизнь.

Отображение можно сделать просто текстовым, например:


    .......
    .......
    .***...
    ...***.
    .......


Где:

  * '.' - пустая ячейка
  * '*' - живая ячейка

Кнопка "Следующий шаг", Кнопка "Редактировать".

При нажатии на "Следующий шаг" - происходит обновление страницы - согласно 
правилам Жизни - появление и исчезновение клеток.

При нажатии на "Редактировать" - открывается формы где в простом текстовом виде
можно отредактировать где у нас пустые ячейки, а где живые.


## Устанавливаем Синатру

    gem install sinatra


Создаём скрипт приложения `app.rb`:

    # web application
    require 'rubygems'
    require 'sinatra'
    require 'lib/game_life'

    INIT_GENERATION = \
    ".......\n" +
    ".......\n" +
    ".***...\n" +
    "...***.\n" +
    ".......\n"

    get '/' do
      game = GameLife.new :empty_cell=>'.', :life_cell=>'*'
      game.first_generation = INIT_GENERATION
      @screen = game.screen
      erb :index
    end

    post '/' do
      game = GameLife.new :empty_cell=>'.', :life_cell=>'*'
      game.first_generation = params[:g]
      game.do_step
      @screen = game.screen
      erb :index
    end

    __END__

    @@ layout
    <html>
      <head>
      <title>Life</title>
      </head>
      <body>
        <%= yield %>
      </body>
    </html>

    @@ index
      <form action="/" method="post">
      <pre><%= @screen %></pre>
      <input type="hidden" name="g" value="<%= @screen %>">
      <input type="submit" value="Step">
      </form>

Запускаем командой:

  ruby app.rb

Открываем браузером `http://localhost:4567`

